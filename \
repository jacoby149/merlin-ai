"""
    commands.py
"""
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel
import settings

# Create a router instance.
router = APIRouter(prefix="/auto_coder", tags=["auto_coder"])

@router.post("/api_mod")
async def api_mod(chat:str):
    """
    Restarts the entire UI container using the Docker SDK. The container is located
    by filtering on the Docker Compose service label "ui", and then restarted using
    the Docker API. Note: since this endpoint runs inside the container, the connection
    may drop when the container stops.
    """
    try:
        # Locate the UI container using its Docker Compose service label.
        containers = client.containers.list(filters={"label": "com.docker.compose.service=ui"})
        if not containers:
            raise HTTPException(status_code=404, detail="UI container not found")
        container = containers[0]
        
        # Restart the container.
        container.restart(timeout=10)
        
        return {"message": "UI container restarted"}
    except docker.errors.DockerException as e:
        raise HTTPException(status_code=500, detail=f"Error restarting UI container: {e}")

